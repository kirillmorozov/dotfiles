---
- name: Install packages
  connection: local
  hosts: localhost
  tasks:
    - name: macOS packages installed
      when: ansible_distribution == "MacOSX"
      community.general.homebrew:
        package:
          - fd
          - fzf
          - go-task
          - helix
          - jq
          - lazygit
          - neovim
          - ripgrep
          - starship
          - yq
    - name: Add GitHub CLI repository
      become: true
      when: ansible_distribution == "Linux Mint"
      block:
        - name: Get keyring
          ansible.builtin.get_url:
            url: https://cli.github.com/packages/githubcli-archive-keyring.gpg
            dest: /etc/apt/keyrings/githubcli-archive-keyring.gpg
        - name: Add repository
          ansible.builtin.apt_repository:
            repo: >
              deb [arch={{ ansible_architecture }}
              signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg]
              https://cli.github.com/packages stable main
    - name: Linux Mint packages installed
      become: true
      when: ansible_distribution == "Linux Mint"
      ansible.builtin.apt:
        package:
          - fd-find
          - fzf
          - gh
          - git
          - jq
          - neovim
          - ripgrep
          - task
          - vim
          - yq
          - zsh
    - name: Add GitHub CLI repository
      become: true
      when: ansible_distribution == "Fedora"
      ansible.builtin.yum_repository:
        name: gh-cli
        description: GitHub CLI
        baseurl: https://cli.github.com/packages/rpm/gh-cli.repo
    - name: Fedora packages installed
      become: true
      when: ansible_distribution == "Fedora"
      ansible.builtin.dnf:
        pkg:
          - fd-find
          - fzf
          - gh
          - git
          - go-task
          - jq
          - neovim
          - ripgrep
          - vim
          - yq
          - zsh
    # TODO: set Zsh as the default shell for current user

- name: Create symlinks
  connection: local
  hosts: localhost
  vars:
    xdg_config_dir: ~/.config
  roles:
    - role: stow
      vars:
        target_path: "~"
        src_dir: "{{playbook_dir}}/vim"
    - role: stow
      vars:
        target_path: "~"
        src_dir: "{{playbook_dir}}/zsh"
    - role: stow
      vars:
        target_path: "~"
        src_dir: "{{playbook_dir}}/task"
    - role: stow
      vars:
        target_path: "~"
        src_dir: "{{playbook_dir}}/wezterm"
    - role: stow
      vars:
        target_path: "{{ xdg_config_dir }}/nvim"
        src_dir: "{{playbook_dir}}/neovim"
    - role: stow
      vars:
        target_path: "{{ xdg_config_dir }}/alacritty"
        src_dir: "{{playbook_dir}}/alacritty"
    - role: stow
      vars:
        target_path: "{{ xdg_config_dir }}/helix"
        src_dir: "{{playbook_dir}}/helix"
