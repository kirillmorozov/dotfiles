---
version: '3'

vars:
  ALACRITTY_CONFIG_DIR: ~/.config/alacritty
  ALACRITTY_DARK_THEME: rose-pine
  ALACRITTY_LIGHT_THEME: rose-pine-dawn
  GTK_DARK_THEME: Mint-Y-Dark-Red
  GTK_LIGHT_THEME: Mint-Y-Red
  HELIX_CONFIG_DIR: ~/.config/helix
  HELIX_DARK_THEME: rose_pine
  HELIX_LIGHT_THEME: rose_pine_dawn

tasks:
  change-theme:
    desc: Switch from one theme to another.
    internal: true
    platforms: [linux]
    silent: true
    requires:
      vars:
        - NEW
        - OLD
        - WHERE
    status:
      - '[ ! -f {{.WHERE}} ]'
    cmds:
      - sed --follow-symlinks -i 's/{{.OLD}}/{{.NEW}}/' {{.WHERE}}

  # yamllint disable-line rule:key-duplicates
  change-theme:
    desc: Switch from one theme to another.
    internal: true
    platforms: [darwin]
    silent: true
    requires:
      vars:
        - NEW
        - OLD
        - WHERE
    vars:
      FILE_PATH:
        sh: "[ -h {{.WHERE}} ] && readlink {{.WHERE}} || echo {{.WHERE}}"
    status:
      - '[ ! -f {{.WHERE}} ]'
    cmds:
      - sed -i '' -e 's/{{.OLD}}/{{.NEW}}/' "{{.FILE_PATH}}"

  change-cinnamon-theme:
    internal: true
    platforms: [linux]
    silent: true
    requires:
      vars:
        - COLOR_SCHEME
        - GTK_THEME
    cmds:
      - gsettings set org.cinnamon.desktop.interface gtk-theme {{.GTK_THEME}}
      - gsettings set org.cinnamon.theme name {{.GTK_THEME}}
      - gsettings set org.gnome.desktop.interface gtk-theme {{.GTK_THEME}}
      - gsettings set org.x.apps.portal color-scheme {{.COLOR_SCHEME}}

  light:
    desc: Switch to light theme.
    deps:
      - task: change-cinnamon-theme
        vars:
          COLOR_SCHEME: prefer-light
          GTK_THEME: "{{.GTK_LIGHT_THEME}}"
      - task: change-theme
        vars:
          NEW: "{{.ALACRITTY_LIGHT_THEME}}.yml"
          OLD: "{{.ALACRITTY_DARK_THEME}}.yml"
          WHERE: "{{.ALACRITTY_CONFIG_DIR}}/alacritty.yml"
      - task: change-theme
        vars:
          NEW: "{{.ALACRITTY_LIGHT_THEME}}.toml"
          OLD: "{{.ALACRITTY_DARK_THEME}}.toml"
          WHERE: "{{.ALACRITTY_CONFIG_DIR}}/alacritty.toml"
      - task: change-theme
        vars:
          NEW: "\"{{.HELIX_LIGHT_THEME}}\""
          OLD: "\"{{.HELIX_DARK_THEME}}\""
          WHERE: "{{.HELIX_CONFIG_DIR}}/config.toml"

  dark:
    desc: Switch to dark theme.
    deps:
      - task: change-cinnamon-theme
        vars:
          GTK_THEME: "{{.GTK_DARK_THEME}}"
          COLOR_SCHEME: prefer-dark
      - task: change-theme
        vars:
          NEW: "{{.ALACRITTY_DARK_THEME}}.yml"
          OLD: "{{.ALACRITTY_LIGHT_THEME}}.yml"
          WHERE: "{{.ALACRITTY_CONFIG_DIR}}/alacritty.yml"
      - task: change-theme
        vars:
          NEW: "{{.ALACRITTY_DARK_THEME}}.toml"
          OLD: "{{.ALACRITTY_LIGHT_THEME}}.toml"
          WHERE: "{{.ALACRITTY_CONFIG_DIR}}/alacritty.toml"
      - task: change-theme
        vars:
          NEW: "\"{{.HELIX_DARK_THEME}}\""
          OLD: "\"{{.HELIX_LIGHT_THEME}}\""
          WHERE: "{{.HELIX_CONFIG_DIR}}/config.toml"
